# API 常用 API 汇总

## chrome.runtime 运行时相关

### 获取扩展 id

`chrome.runtime.id`

### 获取扩展资源地址

`chrome.runtime.getURL('xxx.html')`

#### 重启插件

`chrome.runtime.reload()`



## chrome.tabs 标签页

### 事件监听

```ts

/* 测试生命周期 */
chrome.tabs.onUpdated.addListener(async (tabId, changeInfo, tab) => {
  console.log("onUpdated>>>", tabId, changeInfo, tab);
});  
// 点击选中的 tab 变化时
chrome.tabs.onActivated.addListener((res) => {
  console.log("onActivated>>>", res);
});
chrome.tabs.onAttached.addListener((tabId, attachInfo) => {
  console.log("onAttached>>>", tabId, attachInfo);
});
chrome.tabs.onCreated.addListener((tab) => {
  console.log("onCreated>>>", tab);
});
chrome.tabs.onDetached.addListener((tabId, detachInfo) => {
  console.log("onDetached>>>", tabId, detachInfo);
});
// 选中的 tab 页变化时，包括 tab 切换和移动
chrome.tabs.onHighlighted.addListener(({ tabIds, windowId }) => {
  console.log("onHighlighted>>>", highlightInfo);
});
// tab 标签移动时
chrome.tabs.onMoved.addListener((tabId, moveInfo) => {
  console.log("onMoved>>>", tabId, moveInfo);
});
chrome.tabs.onRemoved.addListener((tabId, removeInfo) => {
  console.log("onRemoved>>>", tabId, removeInfo);
});
chrome.tabs.onReplaced.addListener((addedTabId, removedTabId) => {
  console.log("onReplaced>>>", addedTabId, removedTabId);
});
// popup 打开或关闭
chrome.tabs.onZoomChange.addListener((ZoomChangeInfo) => {
  console.log("onZoomChange>>>", ZoomChangeInfo);
});
```





## chrome.scripting 脚本

### 动态注入各类代码

```js
// 动态执行JS代码
chrome.scripting.executeScript(
  {
    files: 'JS 文件路径',
    func: '函数名',
    target: {
      tabId: '标签页id',
    }
  },
  callback
)
// 动态执行CSS代码
chrome.scripting.insertCSS(
  injection: {
    css: '样式字符串',
    files: '样式文件路径',
  },
  callback?: function,
)
```

## chrome.storage 缓存

## chrome.cookies

### 获取该站点所有 cookie

```js
const url = 'https://www.baidu.com';
chrome.cookies.getAll({url}, cookies => {};
```

### 删除站点某个 cookie

```js
const url = "https://www.baidu.com";
const cookieName = "userName";
chrome.cookies.remove({ url, name: cookieName }, (details) => {});
```





## pageCapture

可以将当前页面保存成 mhtml

```ts
function handleSavePage() {
  chrome.pageCapture.saveAsMHTML({ tabId: tab.id }, (arrayBuffer) => {
    const blob = new Blob([arrayBuffer], { type: "application/octet-stream" });
    // 下载 blob 格式的文件到本地
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "page.mhtml";
    a.click();
  });
}
```

